<!DOCTYPE html>
<html>
<head>
  <title>Проект "Комменты"</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <!-- Комментарии будут добавлены здесь -->
    <ul class="comments"></ul>

    <!-- Форма для добавления комментария -->
    <div class="add-form">
      <input
        type="text"
        class="add-form-name"
        placeholder="Введите ваше имя"
      />
      <textarea
        type="textarea"
        class="add-form-text"
        placeholder="Введите ваш комментарий"
        rows="4"
      ></textarea>
      <div class="add-form-row">
        <button class="add-form-button">Написать</button>
      </div>
    </div>
  </div>

  <script>
    "use strict";

    document.addEventListener("DOMContentLoaded", function () {
      const commentsList = document.querySelector(".comments");
      const nameInput = document.querySelector(".add-form-name");
      const commentInput = document.querySelector(".add-form-text");
      const addButton = document.querySelector(".add-form-button");

      // Массив данных с комментариями
      let comments = [
        {
          name: "Глеб Фокин",
          date: "12.02.22 12:18",
          text: "Это будет первый комментарий на этой странице",
          likes: 3,
          isLiked: false,
        },
        {
          name: "Варвара Н.",
          date: "13.02.22 19:22",
          text: "Мне нравится как оформлена эта страница! ❤",
          likes: 75,
          isLiked: true,
        },
      ];

      // Функция экранирования HTML-символов
      function escapeHTML(text) {
        return text
          .replaceAll("&", "&amp;")
          .replaceAll("<", "<")
          .replaceAll(">", ">")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#x27;");
      }

      // Функция рендера всех комментариев
      function renderComments() {
        commentsList.innerHTML = "";

        comments.forEach((comment, index) => {
          // Экранируем данные перед вставкой
          const safeName = escapeHTML(comment.name);
          const safeText = escapeHTML(comment.text);
          const safeDate = escapeHTML(comment.date);

          // Создаём элемент комментария
          const li = document.createElement("li");
          li.classList.add("comment");
          li.dataset.index = index;

          li.innerHTML = `
            <div class="comment-header">
              <div>${safeName}</div>
              <div>${safeDate}</div>
            </div>
            <div class="comment-body">
              <div class="comment-text">${safeText}</div>
            </div>
            <div class="comment-footer">
              <div class="likes">
                <span class="likes-counter">${comment.likes}</span>
                <button class="like-button ${comment.isLiked ? "-active-like" : ""}" data-index="${index}"></button>
              </div>
            </div>
          `;

          // Обработчик клика на кнопку лайка
          const likeButton = li.querySelector(".like-button");
          likeButton.addEventListener("click", (event) => {
            event.stopPropagation(); // Останавливаем всплытие → не сработает ответ
            toggleLike(index);
          });

          // Обработчик клика по карточке комментария — для ответа
          li.addEventListener("click", () => {
            // При клике подставляем имя автора и цитату
            nameInput.value = comment.name; // ← Вот это было пропущено! Теперь имя подставляется
            commentInput.value += `> ${comment.name}: ${comment.text}\n`;
            commentInput.focus();
          });

          commentsList.appendChild(li);
        });
      }

      // Переключение состояния лайка
      function toggleLike(index) {
        comments[index].isLiked = !comments[index].isLiked;
        comments[index].likes += comments[index].isLiked ? 1 : -1;
        renderComments(); // Перерисовываем всё
      }

      // Отправка нового комментария
      addButton.addEventListener("click", () => {
        let name = nameInput.value.trim();
        let text = commentInput.value.trim();

        if (!name || !text) {
          alert("Пожалуйста, заполните все поля.");
          return;
        }

        // Экранируем ввод пользователя
        name = escapeHTML(name);
        text = escapeHTML(text);

        const newComment = {
          name: name,
          date: new Date().toLocaleString(),
          text: text,
          likes: 0,
          isLiked: false,
        };

        comments.push(newComment);
        renderComments();

        // После отправки очищаем только имя
        nameInput.value = "";
        // Можно оставить комментарий — чтобы можно было писать несколько ответов подряд
      });

      // Первичная отрисовка
      renderComments();
    });
  </script>
</body>
</html>

